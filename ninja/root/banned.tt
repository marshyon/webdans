<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us">
<head>
        <title>banned - login</title>
        <link rel="stylesheet" href="/css/base.css" type="text/css" media="screen" charset="utf-8" />  
        <script type="text/javascript" src="/lib/jquery-1.4.min.js"></script>
        <script type="text/javascript" src="/js/datadumper.js"></script>


        <link rel="stylesheet" href="/css/redmond/jquery-ui-1.8.4.custom.css" type="text/css" id="" media="print, projection, screen" />
        <script type="text/javascript" src="/js/jquery-ui-1.8.4.custom.min.js"></script>
	<style type="text/css">
		body { font-size: 62.5%; }
		label, input { display:block; }
		input.text { margin-bottom:12px; width:95%; padding: .4em; }
		fieldset { padding:0; border:0; margin-top:25px; }
		.ui-dialog .ui-state-error { padding: .3em; }
		.validateTips { border: 1px solid transparent; padding: 0.3em; }
		
	</style>
	<script type="text/javascript">

        function user_logged_in () {
            var login_status = [];
            $.ajax({
              url: 'login_status',
              async: false,
              dataType: 'json',
              success: function (json) {
                login_status = json["login-ok"];
              }
            });
            return login_status;
        }

	$(function() {

		$("#logout-user").hide();
		$("#dialog-form").hide();

        if(user_logged_in()) {
            console.log('still logged in');
            $('#login_status').html('<span class="ui-icon ui-icon-circle-check"></span>');
            $('#login-user').hide();
        } else {
            $('#login_status').html('');
            $('#logout-user').hide();
        }



                $('#logout-user').click(function() {
                    //$('#login_status').load('http://localhost:3000/login?logout=1');
                    $('#login_status').load('login?logout=1');
                    $('#logout-user').hide();
                    $('#login-user').show();
                    $('#login_status').html('');
                }).hover( function(){$(this).addClass('ui-state-hover'); } )
                  .mouseout(function() { $(this).removeClass('ui-state-hover'); }); 
 
                
		
		var name = $("#name"),
			password = $("#password"),
			allFields = $([]).add(name).add(password),
			tips = $(".validateTips");

		function updateTips(t) {
			tips
				.text(t)
				.addClass('ui-state-highlight');
			setTimeout(function() {
				tips.removeClass('ui-state-highlight', 1500);
			}, 500);
		}

		function checkLength(o,n,min,max) {

			if ( o.val().length > max || o.val().length < min ) {
				o.addClass('ui-state-error');
				updateTips("Length of " + n + " must be between "+min+" and "+max+".");
				return false;
			} else {
				return true;
			}

		}

		function checkRegexp(o,regexp,n) {

			if ( !( regexp.test( o.val() ) ) ) {
				o.addClass('ui-state-error');
				updateTips(n);
				return false;
			} else {
				return true;
			}

		}
		
		$("#dialog-form").dialog({
			autoOpen: false,
			height: 250,
			width: 355,
			modal: true,
			buttons: {
				'Submit Login Details': function() {
					var bValid = true;
					allFields.removeClass('ui-state-error');

					bValid = bValid && checkLength(name,"username",3,16);
					bValid = bValid && checkRegexp(name,/^[a-z]([0-9a-z_])+$/i,"Username may consist of a-z, 0-9, underscores, begin with a letter.");
					bValid = bValid && checkLength(password,"password",5,16);
					
					if (bValid) {
                                                var user_name = name.val();
                                                var user_pass = password.val();
                                                var login_url = "login?user=" + user_name + "&password=" + user_pass;
                                                $('#login_status').load(login_url);


                                                if(user_logged_in()) {

                                                    $('#login_status').html('<span class="ui-icon ui-icon-circle-check"></span>');
                                                    $('#login-user').hide();
                                                    $('#logout-user').show();
                                                } else {
                                                    $('#login_status').html('<span class="ui-icon ui-icon-circle-close"></span>');
                                                    $('#login-user').show();
                                                    $('#logout-user').hide();
                                                }

						$(this).dialog('close');
					}
				},
				Cancel: function() {
					$(this).dialog('close');
				}
			},
			close: function() {
				allFields.val('').removeClass('ui-state-error');
			}
		});
		
		
		
		$('#login-user')
			.button()
			.click(function() {
				$('#dialog-form').dialog('open');
			});

	});
	</script>


</head>
<body>

	
<div id="wrapper960">
<div id="container">
    <div id="header">
    </div>

<div id="content">
<h2>Login</h2>
<!--<div class="demo">-->

<div id="dialog-form" title="Login">
	<p class="validateTips">Enter User Name and Password to Login.</p>

	<form>
	<fieldset>
		<label for="name">Name</label>
		<input type="text" name="name" id="name" class="text ui-widget-content ui-corner-all" />
		<label for="password">Password</label>
		<input type="password" name="password" id="password" value="" class="text ui-widget-content ui-corner-all" />
	</fieldset>
	</form>
</div>



<button id="login-user">Login</button> 

<button id="logout-user" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only " role="button" aria-disabled="false"><span class="ui-button-text">Logout</span></button>

<div id="login_status" style="float:right"> </div>









</div><!--end content-->

</div><!--end container-->
</div><!--end wrapper960-->
	
	
	
	



